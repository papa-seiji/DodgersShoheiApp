<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>hogehoge_02</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
  window.MONTH_GAMES = /*[[${monthGames}]]*/ [];
</script>
<script src="/js/hogehoge_02.js"></script>

<style>
/* ===== Layout ===== */
.month-detail-wrapper {
  max-width: 1200px;   /* â† ç”»é¢ã‚’åºƒãä½¿ã„ãŸã„ãªã‚‰ã“ã“ã‚’æ‹¡å¼µ */
  width: 100%;
  margin: 0 auto;     /* â˜… å¸¸ã«ä¸­å¤® */
  padding: 24px 20px 40px;
  box-sizing: border-box;
    overflow-x: hidden; /* â˜…ã“ã‚Œ */
}

.month-title {
  text-align: center;
  font-size: 22px;
  margin-bottom: 20px;
  letter-spacing: 1px;
}

/* ===== Scorebook Table ===== */
.scorebook-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  background: #fffdf6;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
  margin-bottom: 32px;
}

.scorebook-table thead {
  background: #2f2f2f;
  color: #fff;
}

.scorebook-table th,
.scorebook-table td {
  padding: 10px 8px;
  border-bottom: 1px solid #ddd;
  text-align: center;
}

.scorebook-table tbody tr:hover {
  background: #f7f3e8;
}

/* å‹æ•— */
.win { color: #c62828; font-weight: bold; }
.lose { color: #1565c0; font-weight: bold; }

/* èª¿å­ */
.form-s { color: #d32f2f; font-weight: bold; }
.form-a { color: #ef6c00; font-weight: bold; }
.form-b { color: #fbc02d; }
.form-c { color: #546e7a; }

/* ===== è©¦åˆè©³ç´°ã‚«ãƒ¼ãƒ‰ ===== */
.game-card {
  width: 100%;                /* â˜…å¿…é ˆ */
  box-sizing: border-box;     /* â˜…å¿…é ˆ */
  background: #ffffff;
  border: 1px solid #ddd;
  border-radius: 10px;
  /* padding: 16px; */
  margin-bottom: 32px;
}

.game-header {
  display: flex;
  justify-content: space-between;
  font-weight: bold;
  font-size: 15px;
  margin-bottom: 8px;
}

.batting-summary {
  margin: 10px 0 12px;
  font-weight: bold;
}

.atbat-list {
  padding-left: 18px;
  margin-bottom: 12px;
}

.atbat-list li {
  margin-bottom: 4px;
  font-size: 14px;
}

.bat-result {
  margin-left: 6px;
  font-weight: bold;
}

/* ===== Images ===== */
.game-images {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.game-images img {
  width: 100%;
  max-width: 160px;
  border-radius: 6px;
  object-fit: cover;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* ===== Comment ===== */
.game-comment {
  background: #3eb92c8a;
  padding: 12px;
  border-radius: 6px;
  margin-top: 12px;
  margin-bottom: 50px;
}

.game-comment pre {
  margin: 0;
  white-space: pre-wrap;
  font-family: inherit;
  font-size: 14px;
}

/* æˆ»ã‚‹ */
.back-link {
  display: inline-block;
  margin-top: 24px;
  text-decoration: none;
  font-weight: bold;
  color: #3366cc;
  font-size: 28px;
}

/* =====================================================
   â˜… MLBé¢¨ ãƒ©ã‚¤ãƒ³ã‚¹ã‚³ã‚¢ï¼ˆå®Œå…¨å†ç¾ï¼‰
===================================================== */

.linescore-table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0 16px;
  background: #000;
  color: #eee;
  font-size: 13px;
  font-family: "Arial Narrow", "Segoe UI", sans-serif;
  box-shadow: inset 0 0 0 1px #222;
}

.linescore-table th,
.linescore-table td {
  border: 1px solid #222;
  padding: 6px;
  text-align: center;
  min-width: 26px;
}

/* ãƒ˜ãƒƒãƒ€ */
.linescore-table thead th {
  background: #111;
  color: #aaa;
  font-size: 12px;
  font-weight: normal;
}

/* TEAMåˆ— */
.linescore-table th:first-child,
.linescore-table td:first-child {
  min-width: 52px;
  font-weight: bold;
  color: #ddd;
}

/* Away ã‚¤ãƒ‹ãƒ³ã‚° */
.linescore-table tbody tr:first-child td:not(:first-child):not(:nth-last-child(-n+3)) {
  color: #ff9800;
  font-weight: bold;
}

/* Home ã‚¤ãƒ‹ãƒ³ã‚° */
.linescore-table tbody tr:last-child td:not(:first-child):not(:nth-last-child(-n+3)) {
  color: #fdd835;
  font-weight: bold;
}

/* R H E */
.linescore-table td:nth-last-child(3),
.linescore-table td:nth-last-child(2),
.linescore-table td:nth-last-child(1) {
  background: #0b0b0b;
  color: #fff;
  font-weight: bold;
}

/* å‹åˆ©ãƒãƒ¼ãƒ  R */
.linescore-table tr:last-child td:nth-last-child(3) {
  color: #ff5252;
}

/* ãƒãƒ¼ãƒ å */
.linescore-table tr:first-child td:first-child {
  color: #b0bec5;
}
.linescore-table tr:last-child td:first-child {
  color: #64b5f6;
}


.game-row.is-selected {
  background: #d5ad1b;
}


.back-to-month {
  margin: 16px 0;
}

.back-button {
  display: inline-block;
  padding: 6px 12px;
  background: #df8383;
  border-radius: 4px;
  text-decoration: none;
  color: #333;
  font-size: 16px;
}

.back-button:hover {
  background: #0a0a0a;
    color: #ffffff;

}


/* Mobile */
/* @media (max-width: 480px) {
  .linescore-table {
    font-size: 11px;
  }
  .linescore-table th,
  .linescore-table td {
    padding: 4px;
  }
} */

/* ãƒ¢ãƒã‚¤ãƒ«èª¿æ•´ */
/* @media (max-width: 480px) {
  .linescore-table {
    font-size: 11px;
  }

  .linescore-table th,
  .linescore-table td {
    padding: 4px 4px;
  }
} */

</style>
</head>

<body>

<h1>
  <span th:text="${month}">4</span>æœˆã®è©³ç´°ãƒšãƒ¼ã‚¸
</h1>
<!--<p id="info"></p>-->

<a href="/hogehoge_01" class="back-link">
  â† ã‚·ãƒ¼ã‚ºãƒ³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹
</a>

<div class="month-detail-wrapper">

  <!-- ===== 4æœˆ æˆç¸¾æ¨ç§»ã‚°ãƒ©ãƒ• ===== -->
  <div style="margin:0 auto 32px;">
    <canvas id="aprilChart" height="120"></canvas>
  </div>

  <h2 class="month-title">
    <span th:text="${month}">4</span>æœˆ è©¦åˆä¸€è¦§
  </h2>

  <!-- ===== æœˆé–“ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« ===== -->
  <table class="scorebook-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Opponent</th>
        <th>Result</th>
        <th>Form</th>
      </tr>
    </thead>

    <tbody>
      <tr th:each="g : ${monthGames}"
          th:if="${g != null and (param.date == null or g.gameDate.toString() == param.date[0])}"
          th:attr="data-date=${g.gameDate}"
          class="game-row">

        <td>
          <a th:href="@{/hogehoge_02(month=${month}, date=${g.gameDate})}"
             th:text="${#temporals.format(g.gameDate,'MM/dd')}">
            04/06
          </a>
        </td>

        <td th:text="${g.opponent}">PADRES</td>

        <td th:text="${g.result}"
            th:classappend="${g.result.contains('â—')} ? 'lose' : 'win'">
          â—‹ 4-2
        </td>

        <td th:text="
          ${g.formValue == 2 ? 'S' :
            g.formValue == 1 ? 'A' :
            g.formValue == 0 ? 'B' :
            g.formValue == -1 ? 'C' : 'D'}
        ">
        </td>

      </tr>
    </tbody>
  </table>

  <!-- ===== ä¸€è¦§ã«æˆ»ã‚‹ ===== -->
  <div class="back-to-month" th:if="${param.date != null}">
    <a th:href="@{/hogehoge_02(month=${month})}" class="back-button">
      â† <span th:text="${month}">4</span>æœˆã®è©¦åˆä¸€è¦§ã«æˆ»ã‚‹
    </a>
  </div>

  <!-- ===== è©¦åˆè©³ç´°ã‚«ãƒ¼ãƒ‰ ===== -->
  <div class="game-card"
       th:each="g : ${games}"
       th:if="${g != null}"
       th:id="|game-${g.gameDate}|">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="game-header">
      <span th:text="|${#temporals.format(g.gameDate,'MM/dd')} vs ${g.opponent}|"></span>
    </div>

    <!-- è©•ä¾¡
    <span class="form-badge"
          th:text="
            ${g.formValue == 2 ? 'S' :
              g.formValue == 1 ? 'A' :
              g.formValue == 0 ? 'B' :
              g.formValue == -1 ? 'C' : 'D'}
          ">
    </span>-->

<!-- LINE SCORE -->
<table class="linescore-table"
       th:if="${g.homeRunsByInning != null and !#lists.isEmpty(g.homeRunsByInning)}">

    <thead>
    <tr>
        <th>TEAM</th>

        <!-- ã‚¤ãƒ‹ãƒ³ã‚°ç•ªå·ï¼ˆå»¶é•·è‡ªå‹•å¯¾å¿œï¼‰ -->
        <th th:each="i : ${#numbers.sequence(1, g.homeRunsByInning.size())}"
            th:text="${i}">
        </th>

        <th>R</th>
        <th>H</th>
        <th>E</th>
    </tr>
    </thead>

    <tbody>

    <!-- ===================================================== -->
    <!-- ğŸ”¥ LADãŒHOMEã®å ´åˆï¼ˆLADä¸‹æ®µï¼‰ -->
    <!-- ===================================================== -->
    <th:block th:if="${g.homeTeamName == 'Los Angeles Dodgers'}">

        <!-- ä¸Šæ®µ = AWAYï¼ˆç›¸æ‰‹ï¼‰ -->
        <tr>
            <td th:text="${g.awayTeamName}">AWAY</td>

            <td th:each="run : ${g.awayRunsByInning}"
                th:text="${run}">
            </td>

            <td th:text="${g.awayTotalRuns != null ? g.awayTotalRuns : 0}">0</td>
            <td th:text="${g.awayHits != null ? g.awayHits : 0}">0</td>
            <td th:text="${g.awayErrors != null ? g.awayErrors : 0}">0</td>
        </tr>

        <!-- ä¸‹æ®µ = LAD -->
        <tr>
            <td>LAD</td>

            <td th:each="run : ${g.homeRunsByInning}"
                th:text="${run}">
            </td>

            <td th:text="${g.homeTotalRuns != null ? g.homeTotalRuns : 0}">0</td>
            <td th:text="${g.homeHits != null ? g.homeHits : 0}">0</td>
            <td th:text="${g.homeErrors != null ? g.homeErrors : 0}">0</td>
        </tr>

    </th:block>


    <!-- ===================================================== -->
    <!-- ğŸ”¥ LADãŒAWAYã®å ´åˆï¼ˆLADä¸Šæ®µï¼‰ -->
    <!-- ===================================================== -->
    <th:block th:if="${g.awayTeamName == 'Los Angeles Dodgers'}">

        <!-- ä¸Šæ®µ = LAD -->
        <tr>
            <td>LAD</td>

            <td th:each="run : ${g.awayRunsByInning}"
                th:text="${run}">
            </td>

            <td th:text="${g.awayTotalRuns != null ? g.awayTotalRuns : 0}">0</td>
            <td th:text="${g.awayHits != null ? g.awayHits : 0}">0</td>
            <td th:text="${g.awayErrors != null ? g.awayErrors : 0}">0</td>
        </tr>

        <!-- ä¸‹æ®µ = HOMEï¼ˆç›¸æ‰‹ï¼‰ -->
        <tr>
            <td th:text="${g.homeTeamName}">HOME</td>

            <td th:each="run : ${g.homeRunsByInning}"
                th:text="${run}">
            </td>

            <td th:text="${g.homeTotalRuns != null ? g.homeTotalRuns : 0}">0</td>
            <td th:text="${g.homeHits != null ? g.homeHits : 0}">0</td>
            <td th:text="${g.homeErrors != null ? g.homeErrors : 0}">0</td>
        </tr>

    </th:block>

    </tbody>
</table>


    <!-- æ‰“æ’ƒã‚µãƒãƒªãƒ¼ -->
<div class="batting-summary"
     th:if="${g.details != null and !#lists.isEmpty(g.details)}"
     th:with="d=${g.details[0]}"
     th:text="
       (${d.pa1Result != null ? 1 : 0}
      + ${d.pa2Result != null ? 1 : 0}
      + ${d.pa3Result != null ? 1 : 0}
      + ${d.pa4Result != null ? 1 : 0}
      + ${d.pa5Result != null ? 1 : 0}
      + ${d.pa6Result != null ? 1 : 0})
      + 'æ‰“æ•° / ' +
      (${d.pa1Result == 'HIT' || d.pa1Result == 'HR' ? 1 : 0}
      + ${d.pa2Result == 'HIT' || d.pa2Result == 'HR' ? 1 : 0}
      + ${d.pa3Result == 'HIT' || d.pa3Result == 'HR' ? 1 : 0}
      + ${d.pa4Result == 'HIT' || d.pa4Result == 'HR' ? 1 : 0}
      + ${d.pa5Result == 'HIT' || d.pa5Result == 'HR' ? 1 : 0}
      + ${d.pa6Result == 'HIT' || d.pa6Result == 'HR' ? 1 : 0})
      + 'å®‰æ‰“'
     ">
</div>

    <!-- æ‰“å¸­å†…å®¹ -->
    <ul class="atbat-list"
    th:if="${g.details != null and !#lists.isEmpty(g.details)}"
    th:with="d=${g.details[0]}">


      <li th:if="${d.pa1Result != null}">
        <strong>ç¬¬1æ‰“å¸­ï¼š</strong>
        å¯¾æˆ¦æŠ•æ‰‹ <span th:text="${d.pa1Pitcher}"></span>
        ï¼ˆ<span th:text="${d.pa1PitcherHand}"></span>ï¼‰
        <span class="bat-result" th:text="${d.pa1Result}"></span><br>
        <span th:text="${d.pa1Description}"></span>
      </li>

      <li th:if="${d.pa2Result != null}">
        <strong>ç¬¬2æ‰“å¸­ï¼š</strong>
        å¯¾æˆ¦æŠ•æ‰‹ <span th:text="${d.pa2Pitcher}"></span>
        ï¼ˆ<span th:text="${d.pa2PitcherHand}"></span>ï¼‰
        <span class="bat-result" th:text="${d.pa2Result}"></span><br>
        <span th:text="${d.pa2Description}"></span>
      </li>

      <li th:if="${d.pa3Result != null}">
        <strong>ç¬¬3æ‰“å¸­ï¼š</strong>
        å¯¾æˆ¦æŠ•æ‰‹ <span th:text="${d.pa3Pitcher}"></span>
        ï¼ˆ<span th:text="${d.pa3PitcherHand}"></span>ï¼‰
        <span class="bat-result" th:text="${d.pa3Result}"></span><br>
        <span th:text="${d.pa3Description}"></span>
      </li>

      <li th:if="${d.pa4Result != null}">
        <strong>ç¬¬4æ‰“å¸­ï¼š</strong>
        å¯¾æˆ¦æŠ•æ‰‹ <span th:text="${d.pa4Pitcher}"></span>
        ï¼ˆ<span th:text="${d.pa4PitcherHand}"></span>ï¼‰
        <span class="bat-result" th:text="${d.pa4Result}"></span><br>
        <span th:text="${d.pa4Description}"></span>
      </li>

      <li th:if="${d.pa5Result != null}">
        <strong>ç¬¬5æ‰“å¸­ï¼š</strong>
        å¯¾æˆ¦æŠ•æ‰‹ <span th:text="${d.pa5Pitcher}"></span>
        ï¼ˆ<span th:text="${d.pa5PitcherHand}"></span>ï¼‰
        <span class="bat-result" th:text="${d.pa5Result}"></span><br>
        <span th:text="${d.pa5Description}"></span>
      </li>

      <li th:if="${d.pa6Result != null}">
        <strong>ç¬¬6æ‰“å¸­ï¼š</strong>
        å¯¾æˆ¦æŠ•æ‰‹ <span th:text="${d.pa6Pitcher}"></span>
        ï¼ˆ<span th:text="${d.pa6PitcherHand}"></span>ï¼‰
        <span class="bat-result" th:text="${d.pa6Result}"></span><br>
        <span th:text="${d.pa6Description}"></span>
      </li>

    </ul>

<div class="game-comment"
     th:if="${g.comment != null and !#strings.isEmpty(g.comment)}">

<strong
  th:text="
    |${#temporals.format(g.gameDate,'M/d')}ã®ç·è©•ã‚³ãƒ¡ãƒ³ãƒˆï¼š
     è©•ä¾¡ã€${
       g.formValue == 2 ? 'S' :
       g.formValue == 1 ? 'A' :
       g.formValue == 0 ? 'B' :
       g.formValue == -1 ? 'C' : 'D'
     }ã€‘|
  ">
  4/28ã®ç·è©•ã‚³ãƒ¡ãƒ³ãƒˆï¼šè©•ä¾¡ã€Bã€‘
</strong>

  <pre th:text="${g.comment}">
    ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡
  </pre>

</div>


<!-- game-cardã®ä¸‹ã«è¿½åŠ ï¼šShohei HRè¡¨ç¤º -->

<div class="shohei-hr-section"
     th:if="${game != null and game.shoheiHRs != null and !#lists.isEmpty(game.shoheiHRs)}">

    <h4>ğŸ”¥ Shohei HR</h4>

    <div th:each="hr : ${game.shoheiHRs}" class="shohei-hr-card">

        <div>
            ğŸš€ Exit Velocity:
            <span th:text="${hr.launchSpeed}">0</span> mph
        </div>

        <div>
            ğŸ“ Launch Angle:
            <span th:text="${hr.launchAngle}">0</span>Â°
        </div>

        <div>
            ğŸ“ Distance:
            <span th:text="${hr.totalDistance}">0</span> ft
        </div>

    </div>

</div>



<!-- ğŸ”¥ DEBUG MOCK HRè¡¨ç¤ºç¢ºèªãƒ–ãƒ­ãƒƒã‚¯ -->
<div style="background:#111;color:#fff;padding:15px;margin:20px 0;border-radius:8px;"
     th:if="${debugShoheiHRs != null}">

    <h3 style="margin-bottom:10px;">ğŸ”¥ DEBUG Shohei HR MOCK</h3>

    <div th:each="hr : ${debugShoheiHRs}"
         style="padding:8px;background:#222;margin-bottom:8px;border-radius:6px;">

        ğŸš€ EV:
        <span th:text="${hr.launchSpeed}">0</span> mph /

        ğŸ“ LA:
        <span th:text="${hr.launchAngle}">0</span>Â° /

        ğŸ“ Dist:
        <span th:text="${hr.totalDistance}">0</span> ft
    </div>

</div>

<!--<canvas id="hrCanvas"
        width="300"
        height="200"
        style="background:#0b1c2d;border-radius:12px;margin-top:10px;">
</canvas>-->

<canvas id="hrCanvas" style="background:#0b1c2d;border-radius:12px;margin-top:10px;"></canvas>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const canvas = document.getElementById("hrCanvas");
    if (!canvas) return;

    const ctx = canvas.getContext("2d");

    // =========================
    // ã‚­ãƒ£ãƒ³ãƒã‚¹æ‹¡å¤§è¨­å®š
    // =========================
    const displayWidth = 700;
    const displayHeight = 500;
    const scaleFactor = 2.1;

    canvas.width = displayWidth;
    canvas.height = displayHeight;

    ctx.scale(scaleFactor, scaleFactor);

    const launchSpeed = 111.1;
    const launchAngle = 33;
    const distance = 415;

    // =========================
    // å¤–é‡
    // =========================
    ctx.beginPath();
    ctx.moveTo(150, 180);
    ctx.lineTo(40, 120);
    ctx.quadraticCurveTo(150, 40, 260, 120);
    ctx.closePath();
    ctx.fillStyle = "#1e7a34";
    ctx.fill();

    ctx.beginPath();
    ctx.moveTo(150, 180);
    ctx.lineTo(40, 120);
    ctx.moveTo(150, 180);
    ctx.lineTo(260, 120);
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(40, 120);
    ctx.quadraticCurveTo(150, 40, 260, 120);
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 6;
    ctx.lineCap = "round";
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(40, 125);
    ctx.quadraticCurveTo(150, 50, 260, 125);
    ctx.strokeStyle = "rgba(0,0,0,0.6)";
    ctx.lineWidth = 8;
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(40, 120);
    ctx.lineTo(40, 40);
    ctx.moveTo(260, 120);
    ctx.lineTo(260, 40);
    ctx.strokeStyle = "#ffd700";
    ctx.lineWidth = 1;
    ctx.stroke();

    // =========================
    // å†…é‡
    // =========================
    ctx.beginPath();
    ctx.moveTo(150, 180);
    ctx.lineTo(95, 150);
    ctx.lineTo(150, 120);
    ctx.lineTo(205, 150);
    ctx.closePath();
    ctx.fillStyle = "#000";
    ctx.fill();

    function drawBase(x, y) {
        const size = 8;
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(Math.PI / 4);
        ctx.fillStyle = "#fff";
        ctx.fillRect(-size/2, -size/2, size, size);
        ctx.restore();
    }

    drawBase(150, 174);
    drawBase(100, 150);
    drawBase(150, 126);
    drawBase(200, 150);

    // =========================
    // å¼¾é“è¨ˆç®—
    // =========================
    const homeX = 150;
    const homeY = 180;

    const centerFT = 361;
    const a = 110;
    const b = 140;

    const sprayAngle = 55;
    const directionRad = sprayAngle * Math.PI / 180;
    const angleRad = launchAngle * Math.PI / 180;

    const maxRadius =
        (a * b) /
        Math.sqrt(
            (b * Math.cos(directionRad))**2 +
            (a * Math.sin(directionRad))**2
        );

    const ratio = distance / centerFT;
    const finalRadius = maxRadius * ratio;

    const endX = homeX + finalRadius * Math.cos(directionRad);
    const endY = homeY - finalRadius * Math.sin(directionRad);

    const peakRadius = finalRadius * 0.55;

    const peakX = homeX + peakRadius * Math.cos(directionRad);
    const peakY =
        homeY -
        peakRadius * Math.sin(directionRad) -
        (Math.sin(angleRad) * 80);

    ctx.beginPath();
    ctx.moveTo(homeX, homeY);
    ctx.quadraticCurveTo(peakX, peakY, endX, endY);
    ctx.strokeStyle = "#ffb74d";
    ctx.lineWidth = 4;
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(endX, endY, 6, 0, Math.PI * 2);
    ctx.fillStyle = "#ff1744";
    ctx.shadowBlur = 15;
    ctx.shadowColor = "#ff1744";
    ctx.fill();
    ctx.shadowBlur = 0;

    const estimatedHeight = Math.round(
        distance * Math.sin(angleRad) * 0.45
    );


// =========================
// ğŸ¯ æ”¾ç‰©ç·šä¸Šã®ä»»æ„ç‚¹ã‚’å–å¾—
// =========================
function getQuadraticPoint(t, x0, y0, cx, cy, x1, y1) {
    const x =
        (1 - t) * (1 - t) * x0 +
        2 * (1 - t) * t * cx +
        t * t * x1;

    const y =
        (1 - t) * (1 - t) * y0 +
        2 * (1 - t) * t * cy +
        t * t * y1;

    return { x, y };
}


    // =========================
    // å¹ãå‡ºã—æç”»é–¢æ•°
    // =========================
    function drawBubble(x, y, title, value) {

        ctx.save();
        ctx.setTransform(1, 0, 0, 1, 0, 0);

        x *= scaleFactor;
        y *= scaleFactor;

        const titleParts = title.split(" ");
        const valueParts = value.split(" ");

        const lineHeight = 13;
        const padding = 0;

        ctx.font = "bold 15px Arial";
        let maxWidth = 0;

        [...titleParts, ...valueParts].forEach(t => {
            maxWidth = Math.max(maxWidth, ctx.measureText(t).width);
        });

        const radius = Math.max(26, maxWidth / 2 + padding);

        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fillStyle = "#f2f4f7";
        ctx.fill();
        ctx.strokeStyle = "#d0d4d8";
        ctx.lineWidth = 1.5;
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(x - 6, y + radius);
        ctx.lineTo(x + 6, y + radius);
        ctx.lineTo(x, y + radius + 8);
        ctx.closePath();
        ctx.fill();

        ctx.textAlign = "center";

        let totalLines = titleParts.length + valueParts.length;
        let startY = y - ((totalLines - 1) * lineHeight) / 2;

        ctx.fillStyle = "#6b7280";
        ctx.font = "10px Arial";
        titleParts.forEach(t => {
            ctx.fillText(t, x, startY);
            startY += lineHeight;
        });

        ctx.fillStyle = "#111827";
        ctx.font = "bold 15px Arial";
        valueParts.forEach(v => {
            ctx.fillText(v, x, startY);
            startY += lineHeight;
        });

        ctx.restore();
    }

    // =========================
    // ğŸ¯ Statcastå¯„ã›é…ç½®
    // =========================

    const normalX = -Math.sin(directionRad);
    const normalY = -Math.cos(directionRad);

    // HEIGHTï¼ˆãƒ”ãƒ¼ã‚¯å¤–å´ï¼‰
    // æ”¾ç‰©ç·šã®ä¸­è…¹ï¼ˆt=0.45ãã‚‰ã„ï¼‰
    const midPoint = getQuadraticPoint(
        0.45,
        homeX, homeY,
        peakX, peakY,
        endX, endY
    );

    drawBubble(
        midPoint.x,
        midPoint.y - 25,
        "HEIGHT",
        estimatedHeight + " FT"
    );

    // DISTANCEï¼ˆç€å¼¾å¤–å´ï¼‰
    drawBubble(
        endX,
        endY - 30,
        "DISTANCE",
        distance + " FT"
    );

    // EXIT VELOCITYï¼ˆãƒ›ãƒ¼ãƒ å·¦ä¸‹ï¼‰
    drawBubble(
        homeX - 25,
        homeY + 12,
        "EXIT VELOCITY",
        launchSpeed + " MPH"
    );

    // LAUNCH ANGLEï¼ˆãƒ›ãƒ¼ãƒ å³ä¸‹ï¼‰
    drawBubble(
        homeX + 20,
        homeY + 10,
        "LAUNCH ANGLE",
        launchAngle + "Â°"
    );

});
</script>


<script th:inline="javascript">
/*<![CDATA[*/
window.CHART_LABELS = [[${chartLabels}]];
window.CHART_VALUES = [[${chartValues}]];
/*]]>*/
</script>

<!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ï¼ˆ1å›ã ã‘ï¼‰ -->
<script th:inline="javascript">
/*<![CDATA[*/
window.SELECTED_DATE = [[${selectedDate}]];

if (window.SELECTED_DATE) {

  const targetCard =
    document.getElementById('game-' + window.SELECTED_DATE);

  if (targetCard) {
    targetCard.scrollIntoView({
      behavior: 'smooth',
      block: 'start'
    });
  }

  document.querySelectorAll('.game-row')
    .forEach(row => {
      if (row.dataset.date === window.SELECTED_DATE) {
        row.classList.add('is-selected');
      }
    });
}
/*]]>*/
</script>

</body>
</html>
