<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="fragments/header :: head ('Home Page')"></th:block>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
    <script src="/js/role-check.js"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/Douga.css}">
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="/js/home.js"></script> <!-- home.jsを追加 -->
    <script src="/js/notifications.js"></script><!-- JavaScriptファイルを読み込む -->
    <script src="/js/news-section.js"></script><!-- JavaScriptファイルを読み込む -->


</head>
<body>
<!--Start ナビゲーションバー -->
<div id="header-navbar">
    <div id="header-left">
        <div id="header-logo">
        <img src="/images/みんな日本から応援してるぜッ！LOGO.jpg" alt="背景画像1" class="home-image10">
        <img src="/images/みんな日本から応援してるぜッ！.jpg" alt="背景画像1" class="home-image11">
        </div>
        <div id="header-info-container">
            <div id="user-info">2件 P. Seijiさん</div>
            <div id="visitor-counter-display"><span id="visitor-counter-value">243</span>人目</div>
        </div>
    </div>
    <nav id="header-nav-links">
        <div class="navbar-dropdown">
            <span class="navbar-dropdown-trigger" onclick="toggleDropdown()">Home</span>
            <div class="navbar-dropdown-content">
                <!-- <a href="/home">Home</a> -->
                <a href="/proud">Proud</a>
                <a href="/comments">Chat</a>
                <a href="/links">Links</a>
                <a href="/auth/logout">Logout</a>
            </div>
        </div>
    </nav>
</div>
            <!-- 吹き出しの追加 -->
            <div id="tooltip-navbar" class="tooltip">
                  どのページでもこの部分を押下で<br>  ”メニュー”が開くよ
                 <button class="tooltip-close" data-tooltip-id="navbar">✖</button>
            </div>
        </div>
    </nav>
</div>

<script>
    function toggleDropdown() {
        const dropdown = document.querySelector('.navbar-dropdown');
        dropdown.classList.toggle('open');
    }

    // 外部クリックでドロップダウンを閉じる
    document.addEventListener('click', function (event) {
        const dropdown = document.querySelector('.navbar-dropdown');
        const isClickInside = dropdown.contains(event.target);

        if (!isClickInside && dropdown.classList.contains('open')) {
            dropdown.classList.remove('open');
        }
    });

    // 吹き出しの制御
// 🛠️ Navbar の吹き出しを閉じる
function closeNavbarTooltip() {
    document.getElementById('tooltip-navbar').style.display = 'none';
    localStorage.setItem('hideNavbarTooltip', 'true'); // 次回以降非表示
}

// 🛠️ Navbar の吹き出しの状態を確認
document.addEventListener('DOMContentLoaded', function () {
    if (localStorage.getItem('hideNavbarTooltip') === 'true') {
        document.getElementById('tooltip-navbar').style.display = 'none';
    }
});
</script>
<!--End ナビゲーションバー -->


    <th:block th:replace="fragments/header :: header"></th:block>

<!-- start ニュース/トピック/サイト最新情報 -->
    <section id="news-section">
        <div class="news-header">
            <h2 id="news">NEWSトピック</h2>
        </div>
        <div class="news-window">
            <div class="news-list">
                <!-- JavaScriptで動的に埋め込み -->
            </div>
        </div>
    </section>

    <!-- モーダル -->
    <div id="news-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">×</span>
            <h3 id="modal-title"></h3>
            <img id="modal-image" src="" alt="" style="width: 100%; display: none; margin-bottom: 10px;">
            <p id="modal-content"></p>
            <div id="modal-images"></div> <!-- 複数画像用コンテナ -->
        </div>
    </div>
<!-- end ニュース/トピック/サイト最新情報 -->



    <h1 id="oomidashi" class="shiny-text">♥ワールドチャンピオンおめでとう♥</h1>
    <div id="confetti-container"><h1 id="fifty_fifty" class="shiny-text">大谷翔平MVP&54-59おめでとう</h1></div>
    <h5 class="shiny-text-1">目標は2025年MLB開幕戦Cubs対Dodgers観戦すること</h5>
    <h5 class="shiny-text-1">2024は打者成績のみになりますので、投手成績は</h5>
    <h5 class="shiny-text-1">2023のエンゼルス当時の成績を表示しております</h5>
    <h5 class="shiny-text-1">(statsapi.mlb.comより非同期で抽出して表示)</h5>
    <h5 class="shiny-text-1">見て下さい！2024打者成績凄すぎるでしょ～</h5>
    <h5 id="h5under_row" class="shiny-text-1">今期二刀流復活が楽しみ！みんなで応援しましょう！</h5>



            <div class="stats-container-1">
            <div>
                <div id="SeasonStats-1">2024 Stats</div>
                <!-- 打者成績セクション -->
                <div id="hitter-stats">
                    <div id="HitterStats-1">Hitter Stats</div>
                    <div><strong>Games:</strong> <span id="gamesPlayed"></span></div>
                    <div><strong>Average (AVG):</strong> <span id="avg"></span></div>
                    <div><strong>Home Runs:</strong> <span id="homeRuns"></span></div>
                    <div><strong>Stolen Bases:</strong> <span id="stolenBases"></span></div>
                    <div><strong>RBIs:</strong> <span id="rbi"></span></div>
                    <div><strong>OPS:</strong> <span id="ops"></span></div>
                </div>
            </div>
            <img src="/images/trimmin'-ohtani_swinggin'.png" alt="背景画像1" class="home-image6">
        </div>
        <!-- main カウンタ -->
        <h3>HomeRun: <span id="main-counter-value">0</span></h3>
        <div id="main-counter-controls" class="admin-controls" style="display: none;">
            <button id="main-increment-button">UP</button>
            <button id="main-decrement-button">DW</button>
        </div>



        <div>👼エンゼルス当時</div>
        <div class="stats-container-2">
            <div>
                <div id="SeasonStats-2">2023 Stats</div>
                <!-- 投手成績セクション -->
                <div id="pitcher-stats">
                    <div id="pitcher-stats-2">Pitcher Stats</div>
                    <div id="pitcher-stats-2_child"><strong>Games:</strong> <span id="pitcherGamesPlayed"></span></div>
                    <div id="pitcher-stats-2_child"><strong>Wins:</strong> <span id="wins"></span></div>
                    <div id="pitcher-stats-2_child"><strong>Losses:</strong> <span id="losses"></span></div>
                    <div id="pitcher-stats-2_child"><strong>ERA:</strong> <span id="era"></span></div>
                    <div id="pitcher-stats-2_child"><strong>Strikeouts:</strong> <span id="strikeOuts"></span></div>
                </div>
            </div>
            <img src="/images/LAD投げる大谷翔平-removebg-preview.png" alt="背景画像1" class="home-image9">
        </div>
        <!-- secondary カウンタ -->
        <h3>PitchingWin: <span id="secondary-counter-value">0</span></h3>
        <div id="secondary-counter-controls" class="admin-controls" style="display: none;">
            <button id="secondary-increment-button">UP</button>
            <button id="secondary-decrement-button">DW</button>
        </div>
        
        
    <script src="/js/stats.js"></script>



<!--Start 動画セクション 2025-->
    <div id="hoge-hoge_landing3" class="shiny-text-1">DodgerFest 2025: Shohei Ohtani interview</div>
    <h5 class="shiny-text-1">今期のDodgerFestの動画です</h5>
    <h5 class="shiny-text-1">消防署行った時と髪型が変わりましたね</h5>
    <h5 class="shiny-text-1">順調そうで何よりです！</h5>

        <div class="douga-section_3">
            <div id="hoge-hoge_3">大谷翔平インタビュー</div>
            <div id="douga-container-3">
                <iframe id="douga-video-3" width="560" height="315" src="https://www.youtube.com/embed/R6VnEjtxti4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
<!--End 動画セクション 2025-->


    <h5 class="shiny-text-1">2024年のお気に入り動画を載せています</h5>
    <h5 class="shiny-text-1">私はマーリンズ戦 6打数6安打,3HR,10打点,２盗塁</h5>
    <h5 class="shiny-text-1">前人未到の50/50達成で沸いたあの1日。</h5>
    <h5 class="shiny-text-1">とんでもない『絶対打つだろう』の緊張感の中、</h5>
    <h5 id="h6under_row" class="shiny-text-1">軽々特大アッパーデッキ着弾の51号が大好きです</h5>

        <h5 class="shiny-text-1">前人未到の50/50達成で沸いたあの1日。</h5>
        <h5 class="shiny-text-1">マーリンズ監督の男気溢れ、最高のスポーツマンシップ</h5>
        <h5 class="shiny-text-1">を持ち大谷に挑んだ経緯を語っている映像が大好きです</h5>
        <h5 class="shiny-text-1">間違いなくこの偉業の立役者でこの人なしでは</h5>
        <h5 id="h6under_row" class="shiny-text-1">野球史上最高の1日は起こらなかったでしょう</h5>


    <!-- 動画セクション -->
    <div id="douga-page">
        <div id="douga-grid">
            <!-- 左側の動画 -->
            <div id="hoge-hoge_landing1" ></div><!-- ベースボール史上最高の１日紹介リンク押下の着地場所 -->
            <div class="douga-section_1">
                <!--<h3>2024 World Series メッツ戦 先制HR</h3>-->
                <div id="hoge-hoge_1">ベースボール史上最高の１日</div>
                <div id="douga-container-1">
                    <!--<iframe id="douga-video-1" width="560" height="315" src="https://www.youtube.com/embed/fuOMrPaLRP4?si=Dv03ihOMgv0ovkUj" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>-->
                    <iframe id="douga-video-1" width="560" height="315" src="https://www.youtube.com/embed/gByTMgn6JxI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>


            <!-- 右側の動画 -->
            <div id="hoge-hoge_landing2" ></div><!-- 【漢】スキップ・シューマッカー監督紹介リンク押下の着地場所 -->
            <div class="douga-section_2">
                <!--<h3>2023年投げてた頃LAA</h3>-->
                <div id="hoge-hoge_2">【漢】スキップ・シューマッカー監督</div>
                <div id="douga-container-2">
                    <!--<iframe id="douga-video-2" width="560" height="315" src="https://www.youtube.com/embed/GVcOeTh6WcY?si=OySizA_xccNE7SOQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>-->
                    <iframe id="douga-video-2" width="560" height="315" src="https://www.youtube.com/embed/yYb-0dn2-Ag" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>
    <img src="/images/スキップ・シューマッカー-インタビュー.jpg" alt="背景画像1" class="home-image5" width="400" height="445">
    <div id="qr-button-section" ></div><!-- QR紹介リンク押下の着地場所 -->


    <!-- QRコードボタン -->
    <div class="qr-button-container">
        <button class="qr-button" onclick="showQRCodeModal()">
            <div class="qr-icon">
                <img src="/images/qr-icon.png" alt="QR Icon">
            </div>
            <span>当サイトのQRコード表示</span>
        </button>
    </div>

    <!-- モーダルウィンドウ -->
    <div id="qr-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeQRCodeModal()">&times;</span>
            <h2>登録して始めてね！登録画面のQR(SignUp)</h2>
            <!-- QRコードが生成される場所 -->
            <canvas id="qr-code-container"></canvas>
        </div>
    </div>



    <div id="fasion">
        <div id="Page_introduction-1">--------</div>
        <div id="Page_introduction-2">P</div>
        <div id="Page_introduction-3">age</div>
        <div id="Page_introduction-4">I</div>
        <div id="Page_introduction-5">ntroductio</div>
        <div id="Page_introduction-6">n</div>
        <div id="Page_introduction-7">--------</div>
    </div>
        <div id="kiji" style="color: red;">各ページ(コンテンツ)の紹介</div>
    <div class="home-layout1">
        <img src="/images/yamamoto_ay2-removebg-preview.png" alt="背景画像1" class="home-image1-1" style="margin-right: 1.7em">
        <div class="home-content1">
            <h1 id="oomidashi" class="shiny-text">Home</h1>
            <div>直近HR&直近投番.mp4</div>
            <div>　リアルタイムHR</div>
            <div id="and">　　　　　&</div>
            <div>　PitchWinカウンター</div>
            <!-- <h4>Top画面、Home画面の説明</h4> -->
        </div>
        <!-- <img src="/images/trimmin'-ohtani_pitchin'.png" alt="背景画像1" class="home-image1"> -->
    </div>




<!-- Proud 吹き出し -->
<div id="tooltip-proud" class="tooltip">
    <span><strong>"Proud"か"画像"</strong>を押すと<br>飛べます</span>
    <button class="tooltip-close" data-tooltip-id="proud"> 　　　　         ✖</button>
</div>

<div class="home-layout2">
    <div class="home-content2">
        <a href="/proud"><h1 id="oomidashi" class="shiny-text">Proud</h1></a>
        <div>応援スタイル</div>
        <div>自慢の応援グッズ..etc..</div>
        <h4 style="margin-top: -2%">画像投稿して自慢(PROUD)してください</h4>
    </div>
    <a href="/proud" class="a1">
        <img src="/images/trimmin'-ohtani_creats.png" alt="背景画像1" class="home-image2">
    </a>
</div>

<!-- Chat 吹き出し -->
<div id="tooltip-chat" class="tooltip">
    <span><strong>"Chat"か"画像"</strong>を押すと<br>飛べます</span>
    <button class="tooltip-close" data-tooltip-id="chat"> 　　　　         ✖</button>
</div>

<div class="home-layout3">
    <a href="/comments" class="a2">
        <img src="/images/trimmin'-ohtani_swinggin'.png" alt="背景画像1" class="home-image3">
    </a>
    <div class="home-content3">
        <a href="/comments"><h1 id="oomidashi" class="shiny-text">Chat</h1></a>
        <div>好きな選手,今日の翔平君</div>
        <div>対戦相手,応援メッセージ..etc..</div>
        <div>リアルタイムでひとこと言い合える</div>
        <h4>いずれは応援コメントがたまったら正式にDodgers翔平君に送ります</h4>
    </div>
</div>

<!-- Link 吹き出し -->
<div id="tooltip-link" class="tooltip">
    <span><strong>"Link"か"画像"</strong>を押すと<br>飛べます</span>
    <button class="tooltip-close" data-tooltip-id="link"> 　　　　         ✖</button>
</div>

<div class="home-layout4" style="margin-bottom: -30%">
    <div class="home-content4">
        <a href="/links"><h1 id="oomidashi" class="shiny-text">Link</h1></a>
        <div>Dodgers,翔平君,由伸君</div>
        <div>デコピン,グッズ,SNS ..etc..</div>
        <h4 style="margin-top: -2%">HomePageリンク集</h4>
    </div>
    <a href="/links" class="a3">
        <img src="/images/DodgersLogo.png" alt="背景画像1" class="home-image4">
    </a>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    function showTooltipIfNeeded(id) {
        const tooltip = document.getElementById(`tooltip-${id}`);
        if (tooltip) {
            // ローカルストレージの値が 'true' でない場合は表示する
            if (localStorage.getItem(`hideTooltip-${id}`) !== 'true') {
                tooltip.style.display = 'block';
            } else {
                tooltip.style.display = 'none';
            }
        }
    }

    function closeTooltip(id) {
        const tooltip = document.getElementById(`tooltip-${id}`);
        if (tooltip) {
            tooltip.style.display = 'none';
            localStorage.setItem(`hideTooltip-${id}`, 'true');
        }
    }

    // 各吹き出しの初期状態をチェック
    showTooltipIfNeeded('navbar');
    showTooltipIfNeeded('proud');
    showTooltipIfNeeded('chat');
    showTooltipIfNeeded('link');

    // 吹き出しを閉じるボタンにイベントを追加
    document.querySelectorAll('.tooltip-close').forEach(button => {
        button.addEventListener('click', function() {
            const tooltipId = this.getAttribute('data-tooltip-id');
            closeTooltip(tooltipId);
        });
    });
});
</script>




    <script>
        let stompClient = null;

        // WebSocket接続を開始
        function connect() {
            const socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);

            stompClient.connect({}, () => {
                console.log("WebSocket connected");

                // MainCounter購読
                stompClient.subscribe('/topic/MainCounter', (message) => {
                    const counter = JSON.parse(message.body);
                    document.getElementById('main-counter-value').textContent = counter.value;
                });

                // SecondaryCounter購読
                stompClient.subscribe('/topic/SecondaryCounter', (message) => {
                    const counter = JSON.parse(message.body);
                    document.getElementById('secondary-counter-value').textContent = counter.value;
                });

                // 初期値を取得
                fetchCounterValue("MainCounter", "main-counter-value");
                fetchCounterValue("SecondaryCounter", "secondary-counter-value");
            });
        }

        // サーバーから現在のカウンター値を取得
        function fetchCounterValue(counterName, elementId) {
            fetch(`/counter/${counterName}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Failed to fetch ${counterName} value`);
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById(elementId).textContent = data.value;
                })
                .catch(error => console.error(`Error fetching ${counterName} value:`, error));
        }

        // カウンターの更新
        function updateCounter(counterName, increment) {
            fetch(`/counter/update?counterName=${counterName}&increment=${increment}`, {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => console.log('Counter updated:', data))
            .catch(error => console.error(`Error updating ${counterName} counter:`, error));
        }

        // ページロード時に接続
        document.addEventListener('DOMContentLoaded', () => {
            connect();

            // MainCounterのボタンイベント
            document.getElementById('main-increment-button').addEventListener('click', () => {
                updateCounter("MainCounter", 1);
            });
            document.getElementById('main-decrement-button').addEventListener('click', () => {
                updateCounter("MainCounter", -1);
            });

            // SecondaryCounterのボタンイベント
            document.getElementById('secondary-increment-button').addEventListener('click', () => {
                updateCounter("SecondaryCounter", 1);
            });
            document.getElementById('secondary-decrement-button').addEventListener('click', () => {
                updateCounter("SecondaryCounter", -1);
            });
        });
    </script>

    <script>
        // ユーザー情報を取得してヘッダーに表示
        function fetchUserInfo() {
            fetch('/auth/userinfo')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch user info');
                    }
                    return response.json();
                })
                .then(data => {
                    const userInfoElement = document.getElementById('user-info');
                    userInfoElement.textContent = `${data.number}番 ${data.position}_${data.username}さん`;
                })
                .catch(error => console.error('Error fetching user info:', error));
        }
    
        // ページロード時にユーザー情報を取得
        document.addEventListener('DOMContentLoaded', fetchUserInfo);
    </script>


<script>
        // モーダルを表示する関数
    function showQRCodeModal() {
        generateQRCode(); // QRコードを生成
        document.getElementById('qr-modal').style.display = 'block';
    }

    // モーダルを閉じる関数
    function closeQRCodeModal() {
        document.getElementById('qr-modal').style.display = 'none';
    }

    // モーダル外をクリックして閉じる処理
    window.onclick = function (event) {
        const modal = document.getElementById('qr-modal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };

    // QRコードを生成する関数
    function generateQRCode() {
        const qrCodeContainer = document.getElementById('qr-code-container');
        qrCodeContainer.innerHTML = ''; // 既存のQRコードをクリア

        const qrText = "[[${'https://letsgoohtanifromjapan.click/auth/signup'}]]"; // tymleafの影響あり QRコードの内容（リンク先URL）
        console.log("QRコードに設定するURL:", qrText);

        // QRコード生成
        try {
            QRCode.toCanvas(qrCodeContainer, qrText, function (error) {
                if (error) {
                    console.error('QRコード生成中にエラーが発生しました:', error.message);
                } else {
                    console.log('QRコードが正常に生成されました:', qrText);
                }
            });
        } catch (error) {
            console.error('予期せぬエラーが発生しました:', error.message);
        }
    }
</script>

    
    <th:block th:replace="fragments/footer :: footer"></th:block>
</body>
</html>
